# Planning

## Decision Making

Chose Stripe Connect Custom account with **_Connect Onboarding_** using the guide from here: [https://stripe.com/en-gb-us/connect/pricing](https://stripe.com/en-gb-us/connect/pricing), based on these particular client requirements:

- [x] Custom contractor onboarding
- [x] Custom form to receive client payment
- [x] Ability for contractor to manage account details
- [x] Ability for contractor to manage debit cards
- [x] Activate weekly contractor payouts
- [ ] Activate instant contractor payouts, only on request
- [x] Controlling percentage sharing between platform and contractor from Stripe or Database

## Implementation Steps

- [Stripe Connect Account Creation](#stripe-connect-account-creation)
- [Contractor Onboarding](#contractor-onboarding)
- [Client payment flow](#client-payment-flow)
- [Commission Calculation](#commission-calculation)
- [Payout to Contractors](#payout-to-contractors)
- [Configure Webhooks](#configure-webhooks)
- [Fraud mitigation](#fraud-mitigation)
- [Implement Frontend Integration](#implement-frontend-integration)
- [Testing](#testing)
- [Documentation](#documentation)
- User dashboard
- Reporting functionality
- Communication channels

### Stripe Connect Account Creation

- [x] Create Platform Custom accounts: done by Arjun

### Contractor Onboarding

> Stripe recommends using account tokens for account creation and update calls

- [x] Indicate acceptance of platform's service agreement which should include Stripe's service agreement
- [x] Create a contractor account with email, DOB, type and company_name for any of the business types: company, non_profit or government_entity
- [x] Collect contractor KYC details (without showing Stripe branding) and submit to Stripe
- [x] Save contractor account details
- [ ] Save contractor debit card details
- [ ] API endpoints to securely receive contractor document uploads and handle the communication with Stripe
- [ ] API for ID document upload
- [ ] API to match captured images(selfies) and data extracted from ID documents
- [ ] Provide means for contractors to download and reupload 1099 Tax documentation
- [ ] Provide means for contractors to re-agree to Stripe service agreement on transfer of account or change of Tax Number

#### Things to Note

- Communicate to contractors that their documents are processed securely through the app without explicitly mentioning Stripe, using clear branding and messaging to reinforce trust and confidence in the app.
- For Stripe to lawfully process personal data according to said instructions, you can be legally required to provide additional disclosures or obtain additional consent. Talk to your lawyer about those possible disclosures and consent.
- Additional cost of $2/month for every contractor account that has received at least one payout on the platform.
- The platform is entirely responsible for fraud detection and prevention and will bear these losses.

### Client payment flow

- [ ] Collect and save client credit card details
- [ ] Implement logic to charge cards on the collection of details
- [x] Implement logic to charge cards on client action
- [ ] Implement payment to single contractor using a bank account or debit card
- [ ] Implement payment to multiple contractors

> Communicate to clients that their transactions are processed securely through the app without explicitly mentioning Stripe, using clear branding and messaging to reinforce trust and confidence in the app.
> The platform is responsible for Stripe fees, refunds, and chargebacks

### Commission Calculation

- [x] Use Stripe application fees to automate commission deductions
- [ ] Allow admin to edit percentage sharing
- [ ] Controlling percentage sharing between platform and contractor from Stripe Dashboard

### Payout to Contractors

- [ ] Implement weekly payout schedule
- [ ] Implement instant payout schedule on request

### Configure Webhooks

- [ ] Setup [Connect webhooks](https://stripe.com/docs/connect/webhooks) on live mode
- [ ] Listen for `account.updated` webhook events for when Stripe shuts down an account
- [ ] Listen for `account.updated` webhook events to detect changes to capability states based on verification of onboarding details, to update DB and ui with isVerified false and reason for failed verification
- [ ] Listen for `payout.created`, `payout.updated`, `payout.paid` `payout.failed` events

### Fraud mitigation

#### Steps to Verify Contractors

> ID verification at any point in this document is before first payout

- [ ] Verify contractors (within a certain amount of time) before they can do business through the app. Provide an API call to update user verification status.
- Examine a contractor’s online presence through social or professional profiles like Facebook, Twitter, or LinkedIn.
- Closely review the contractor’s website (should they reasonably have one).
- Collect appropriate licenses if appropriate for their business.
- [ ] Provide API to confirm their email address if it’s linked to their business domain (for example, send an email to an address at that domain and require a response from it).
- Collect and verify platform-appropriate information such as a physical address, inventory list, or selling history.
- Monitor activity on the platform to get a sense of typical behaviour, which you can use to look for suspicious behaviour.
- [ ] API to pause payments or payouts when suspicious behaviour is detected.
- [ ] Add additional verifications to Connect onboarding and disable payouts or payments until the checks pass, using [Stripe Identity](https://stripe.com/docs/identity)
- [ ] [Reject suspicious accounts](https://stripe.com/docs/api/account/reject)

### Implement Frontend Integration

- [ ] Create API endpoints on the backend to communicate with the Flutter front end.
- [ ] Update the Flutter front end to trigger payment actions and display relevant information to users.

### Testing

- [ ] Test the entire payment flow in the sandbox: verify that payments are correctly processed, commissions are calculated, and payouts are successful.
- [ ] Test the entire payment flow in a live environment: verify that payments are correctly processed, commissions are calculated, and payouts are successful.

### Documentation

- [x] Document the integration process and provide clear instructions for ongoing maintenance.

#### Terms and Privacy Update

- [ ] Include in the app's terms and service, a link to the [Stripe Recipient Agreement](https://stripe.com/connect-account/legal/recipient), clearly stating that accepting current app terms includes accepting the Stripe recipient service agreement. This can be done by updating current terms and service with the following:

```md
GetAllWorkDone uses Stripe to make payouts to contractors. The Stripe Recipient Agreement applies to your receipt of such Payouts. To receive payouts from GetAllWorkDone, you must provide GetAllWorkDone accurate and complete information about you and your business, and you authorize GetAllWorkDone to share it and transaction information related to your payout with Stripe.
```

- [ ] Include Stripe acquirer disclosure in the app's terms and service

```md
Acquirer Disclosure
Payment services are powered by Stripe, Inc. Stripe, Inc. is a Payment Facilitator and/or ISO of:

- Cross River Bank, 2115 Linwood Avenue, Fort Lee, NJ 07024, info@crossriver.com or +1-201-808-7000 (Payment Facilitator and ISO),
- Goldman Sachs Bank USA, 200 West Street, New York, New York 10282, txb-client-service@gs.com or +1-212-902-2000 (Payment Facilitator),
- PNC Bank, N.A., 1600 Market Street, 8th Floor, Pittsburgh, PA 19103, +1-800-PNC-BANK (Payment Facilitator and ISO), and
- Wells Fargo Bank, N.A., P.O. Box 6079, Concord, CA 94524, +1-844-284-6834 (Payment Facilitator and ISO).
```

- [ ] Include in the app's privacy policy, a link to Stripe’s Privacy Policy and the following language:

```md
When you provide personal data in connection with the [Payment Services: term to identify services Stripe provides to contractors], Stripe receives that personal data and processes it following [Stripe’s Privacy Policy](https://stripe.com/privacy).
```

- [ ] Inform platform users of Stripe account onboarding

```md
GetAllWorkDone uses Stripe to get you paid quickly and keep your personal and payment information secure. Thousands of companies around the world trust Stripe to process payments for their users. We help you set up a Stripe account to get paid with GetAllWorkDone.
```

```md
Stripe is processing charges for the platform’s users. Although the platform is initiating and managing the transactions, funds are not flowing through the platform itself.
```

```md
The platform’s user has a Stripe account but relies on the platform to help manage it, and Stripe has a legal obligation to know who they are.
```

## Extras

### Explore Using Radar with Connect

[https://stripe.com/docs/connect/radar](https://stripe.com/docs/connect/radar)

## Meeting Discussion

- [x] Will contractors only be US-based? not only US-based, but start with US-based
- [x] Are contractors individuals only, or can they be individuals and businesses? Both
- [ ] Which tax form is best for the platform: the 1099-MISC form or the 1099-K form?
- [x] What database is the application currently using, so I can integrate with it? MySQL | DynamoDB

## Resources

- [Connect Best Practices](https://stripe.com/docs/connect/best-practices)
- [Using Connect with Custom accounts](https://stripe.com/docs/connect/custom-accounts#identity-verification)
- [Account Tokens](https://stripe.com/docs/connect/account-tokens)
- [File Uploads](https://stripe.com/docs/connect/account-tokens#file-upload)
- [Create an account token](https://stripe.com/docs/api/tokens/create_account)
- [Create a person token](https://stripe.com/docs/api/tokens/create_person)
- [Create an account](https://stripe.com/docs/api/accounts/create)
- [Embedded Onboarding](https://stripe.com/docs/connect/custom/onboarding#embedded-onboarding)
- [Supported Embedded Components](https://stripe.com/docs/connect/supported-embedded-components#account-onboarding)
- [Customize Embedded Components](https://stripe.com/docs/connect/customize-connect-embedded-components)
- [API-based Onboarding](https://stripe.com/docs/connect/custom/onboarding#api-based-onboarding)
- [Stripe Test data](https://stripe.com/docs/connect/testing)
- [Payouts Bank Accounts](https://stripe.com/docs/connect/payouts-bank-accounts)
- [Create a bank account token](https://stripe.com/docs/api/tokens/create_bank_account)
- [Create a connected account bank account](https://stripe.com/docs/api/external_account_bank_accounts/create)
- [List connected account bank accounts](https://stripe.com/docs/api/external_account_bank_accounts/list)
- [Update connected account bank accounts](https://stripe.com/docs/api/external_account_bank_accounts/update)
- [Delete connected account bank accounts](https://stripe.com/docs/api/external_account_bank_accounts/delete)
- [Create a card token](https://stripe.com/docs/api/tokens/create_bank_account)
- [Create a connected account card](https://stripe.com/docs/api/external_account_cards/create)
- [List connected account cards](https://stripe.com/docs/api/external_account_cards/list)
- [Update connected account cards](https://stripe.com/docs/api/external_account_cards/update)
- [Delete connected account cards](https://stripe.com/docs/api/external_account_cards/delete)
- [Creating a charge](https://stripe.com/docs/connect/charges)
- [Stripe Connect charge types: Separate Charges and Transfers](https://www.youtube.com/watch?v=Wn9YrnLnPz4)
- [Accept a payment](https://stripe.com/docs/payments/accept-a-payment)
- [Configure Webhooks](https://dashboard.stripe.com/test/webhooks)

### Using Financial Connections to collect account details

- [Activate this option](https://dashboard.stripe.com/settings/connect/custom)
- [Financial Connections Pricing](https://stripe.com/en-gb-us/financial-connections#pricing)

